<!DOCTYPE html>
<html>
  <head>
    <title>Place Searches</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAu1gWGp2bOSkaQfDLjgHVYD4CH20-Jn78&callback=initMap&libraries=places&v=weekly"
      defer
    ></script>
    <link rel="stylesheet" type="text/css" href="./style.css" />
  </head>
  <body>
    <p>
      latitude: <span id="latitude"></span>&deg;<br />
      longitude: <span id="longitude"></span>&deg;
    </p>
    <div>
      VALITUD KOHT: <span id="demo"></span>
    </div>
    <div id="locationInfo"></div>
    <button onclick="initMap()">Alusta</button>
    <div id="map"></div>

  <script>
let map, infoWindow, marker, bounds, currentInfoWindow;
let posit;
let DirectionsService, temp;
var x;
const placeCategory = ["park", "restoran", "mÃ¤ng", "muuseum", "kaubamaja"];
if (navigator.geolocation) {
navigator.geolocation.getCurrentPosition(position => {
  posit = {
    lat: position.coords.latitude,
    lng: position.coords.longitude
  }
  document.getElementById('latitude').textContent = posit.lat;
  document.getElementById("longitude").textContent = posit.lng;
});
}



function initMap() {
  bounds = new google.maps.LatLngBounds();
  infoWindow = new google.maps.InfoWindow;
  currentInfoWindow = infoWindow;
  infoPane = document.getElementById('panel');
  map = new google.maps.Map(document.getElementById("map"), {
    center: posit,
    zoom: 13,
  });

  bounds.extend(posit);

  infoWindow.setPosition(posit);
          infoWindow.setContent('Location found.');
          infoWindow.open(map);
          map.setCenter(posit);

  
  getNearbyPlaces(posit);


  marker = new google.maps.Marker({
    map,
    draggable: true,
    animation: google.maps.Animation.DROP,
    position: posit,
    label: "Teie asukoht"
  });
}

function getNearbyPlaces(position) {
      let temp = Math.round(random(1,5));
      let request = {
        location: position,
        rankBy: google.maps.places.RankBy.DISTANCE,
        keyword: placeCategory[temp]
      };

      service = new google.maps.places.PlacesService(map);
      service.nearbySearch(request, nearbyCallback);
    }


    function nearbyCallback(results, status) {
      if (status == google.maps.places.PlacesServiceStatus.OK) {
        createMarkers(results);
      }
    }

    function createMarkers(places) {
      let temp = Math.round(random(1, 20));
      let randomPlace = places[temp]
      let marker = new google.maps.Marker({
          position: randomPlace.geometry.location,
          map: map,
          title: randomPlace.name
        });
      document.getElementById("demo").innerHTML = marker.title;
    }

    function random (min, max) {
      return Math.random() * (max - min) + min;
    }
  </script>
  </body>
</html>